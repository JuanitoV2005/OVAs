<!-- Complemento a 2 -->
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Primitivos en Java</title>
    <link rel="stylesheet" href="../assets/css/global/principal.css">
    <link rel="stylesheet" href="../assets/css/global/niveles.css">
    <link rel="stylesheet" href="../assets/css/pag2/complemento-a-2.css">

    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.2/lib/p5.min.js"></script>
    <script src="../assets/js/pag2/rectaNumerica.js"></script>
</head>

<body>
    <main>
        <h1>Complemento a 2:<br>Representación de Números Negativos</h1>
        <h2>Introducción</h2>
        <p>
            Ya sabemos cómo convertir un número como el 5 a su equivalente binario (00000101),
            pero ¿qué hacemos con los números negativos? La computación necesita una forma inteligente de manejar tanto
            positivos
            como negativos usando el mismo espacio de bits. Aquí es donde entra en juego el <strong>complemento a
                2</strong>, la técnica
            que Java
            y la mayoría de los sistemas modernos utilizan para <strong>representar enteros negativos</strong>.
        </p>

        <p>
            Te invitamos a interactuar con el conversor de 1 byte a continuación, probando varios números.
            ¿Se te ocurre alguna idea de cómo funciona el complemento a 2 basándote en lo que ves?
        </p>

        <div class="anchoCompleto" id="recta-complemento-a-2"></div>
        <br>

        <h2>¿De dónde sale el complemento a 2?</h2>
        <p>
            Imagina un reloj con 256 horas: empieza en 0, sigue 1, 2, 3… y cuando llega a 255,
            la siguiente no es 256 sino que vuelve a <strong>cero</strong>.
        </p>

        <p>
            Si estás en la hora 253 y avanzas 3 pasos, pasarás por 254, 255…
            y al siguiente paso el reloj regresa a 0.
            Es como si dieras una vuelta completa.
        </p>

        <p>
            Con números de <strong>8 bits</strong> pasa lo mismo: solo existen los valores del 0 al 255,
            y al pasar de 255 el contador vuelve a 0.
            A esto se le llama <strong>aritmética modular</strong> (módulo 256).
        </p>


        <section class="ejemplo-modulo">
            <div class="expresion">
                <span class="positivo">253</span>
                <span class="signo">+</span>
                <span class="negativo">3</span>
                <span class="igual">=</span>
                <span class="suma">256</span>
                <span class="flecha">→</span>
                <span class="resultado">0</span>
                <span class="modulo">(mod 256)</span>
            </div>
            <div class="expresion">
                <span class="positivo">2</span>
                <span class="signo">+</span>
                <span class="negativo">254</span>
                <span class="igual">=</span>
                <span class="suma">256</span>
                <span class="flecha">→</span>
                <span class="resultado">0</span>
                <span class="modulo">(mod 256)</span>
            </div>
            <p class="explicacion-modulo">
                En un sistema de 8 bits, al sumar 253 y 3 obtenemos 256. <br>Como se desborda, el resultado es
                <strong>0</strong> bajo módulo 256.
            </p>
        </section>

        <p>
            ¿Y qué tiene que ver esto con los negativos? En un sistema de <strong>8 bits</strong>,
            el <strong>“negativo” de un número es aquel que, al sumarse con él,
                completa la vuelta y da 0 (mod 256)</strong>.
            Por ejemplo, la representación negativa de <code>253</code> —su
            <strong>complemento a 2</strong>— es <code>3</code>, porque
            <code>253 + 3 = 256 ≡ 0 (mod 256)</code>.
        </p>
        <h3>Quiz</h3>
        <script>
            // --- Guardar respuestas escritas en inputs en localStorage ---
            // Guardar progreso en las respuestas del input de un quiz, incluso sin validar, en local storage
            function inicializarQuizInputs(formId, storagePrefix = "") {
                const form = document.getElementById(formId);
                const validado = localStorage.getItem(storagePrefix + "validado") === "true";
                const respuestasGuardadas = JSON.parse(localStorage.getItem(storagePrefix + "respuestas") || "{}");

                // Restaurar valores guardados si no está validado
                if (!validado) {
                    for (let key in respuestasGuardadas) {
                        if (form.elements[key]) {
                            form.elements[key].value = respuestasGuardadas[key];
                        }
                    }
                }

                // Guardar automáticamente cada vez que se edita un input (si no está validado)
                for (let input of form.elements) {
                    if (input.tagName === "INPUT" && !validado) {
                        if (input.type === "radio") {
                            input.addEventListener("change", () => {
                                let respuestasGuardadas = JSON.parse(localStorage.getItem(storagePrefix + "respuestas") || "{}");
                                respuestasGuardadas[input.name] = input.value;
                                localStorage.setItem(storagePrefix + "respuestas", JSON.stringify(respuestasGuardadas));
                            });
                        } else {
                            input.addEventListener("input", () => {
                                let respuestasGuardadas = JSON.parse(localStorage.getItem(storagePrefix + "respuestas") || "{}");
                                respuestasGuardadas[input.name] = input.value;
                                localStorage.setItem(storagePrefix + "respuestas", JSON.stringify(respuestasGuardadas));
                            });
                        }
                    }
                }

            }
            window.addEventListener("DOMContentLoaded", () => {
                inicializarQuizInputs("quiz1", "complemento_q1_");
            });
            // Llama a la función para cada quiz en window.onload
            window.addEventListener("load", () => {
                generarQuiz1();
                restaurarQuiz("quiz1", respuestasQ1, "resultadosQ1", "botonValidarQ1", "complemento_q1_");
            });

            // --- CONFIGURACIÓN DE RANGOS ---
            const rangoQ1 = { min: 1, max: 200 }; // Para pregunta 1 (en 8 bits)
            const rangoQ3 = { min: 1, max: 15 };  // Para pregunta 3 (en 4 bits)

            // Función para generar un número aleatorio dentro de un rango
            function randomInRange(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }

            // --- FUNCIÓN PARA GENERAR O RESTAURAR EL QUIZ ---
            function generarQuiz1() {
                let quizData = localStorage.getItem("complemento_q1_numeros");

                if (quizData) {
                    // Restaurar de localStorage
                    quizData = JSON.parse(quizData);
                } else {
                    // Generar nuevos números aleatorios
                    const numQ1 = randomInRange(rangoQ1.min, rangoQ1.max);
                    const numQ3 = randomInRange(rangoQ3.min, rangoQ3.max);

                    quizData = {
                        q1: numQ1,
                        q3: numQ3
                    };

                    // Guardar solo los números en localStorage
                    localStorage.setItem("complemento_q1_numeros", JSON.stringify(quizData));
                }

                // Calcular las respuestas a partir de los números actuales
                const respuestas = {
                    q1: { valor: String((256 - quizData.q1) % 256) }, // complemento en 8 bits
                    q2: { valor: String(16) },                        // fijo en este caso
                    q3: { valor: String((16 - quizData.q3) % 16) }    // complemento en 4 bits
                };

                // Rellenar los números en el HTML
                document.getElementById("q1_num").textContent = quizData.q1;
                document.getElementById("q3_num").textContent = quizData.q3;

                // Hacer global las respuestas
                window.respuestasQ1 = respuestas;
            }

            // Ejecutamos al cargar la página
            // window.onload = generarQuiz;





            // Bloquear inputs y botón si el quiz ya fue validado
            function bloquearFormulario(formId, botonId) {
                const form = document.getElementById(formId);
                for (let input of form.elements) {
                    if (input.tagName === "INPUT") {
                        input.disabled = true;
                    }
                }
                const botonValidar = document.getElementById(botonId);
                if (botonValidar) {
                    botonValidar.disabled = true;
                }
            }
            // Validar si las respuestas de un quiz fueron correctas o no
            function validarFormulario(respuestasDict, formId, resultadoId, botonId, storagePrefix = "", usandoGuardadas = false) {
                const form = document.getElementById(formId);

                let puntaje = 0;
                let respuestasUsuario = {};

                // Si usandoGuardadas, cargar valores guardados en los inputs
                if (usandoGuardadas) {
                    const guardadas = JSON.parse(localStorage.getItem(storagePrefix + "respuestas") || "{}");
                    for (let key in guardadas) {
                        if (form.elements[key]) {
                            form.elements[key].value = guardadas[key];
                        }
                    }
                }

                for (let [key, obj] of Object.entries(respuestasDict)) {
                    const inputs = form.elements[key];
                    let respuestaUsuario = "";

                    if (!inputs) continue;

                    if (inputs.length && inputs[0].type === "radio") {
                        // Es un grupo de radios
                        const checked = form.querySelector(`input[name="${key}"]:checked`);
                        respuestaUsuario = checked ? checked.value : "";
                    } else {
                        // Input normal
                        const input = inputs;
                        respuestaUsuario = input.value.trim();
                    }


                    respuestasUsuario[key] = respuestaUsuario;

                    if (respuestaUsuario === obj.valor) {
                        if (inputs.length && inputs[0].type === "radio") {
                            // grupo de radios: marcar todos en gris y el correcto en verde
                            inputs.forEach(r => {
                                r.parentElement.classList.remove("correcto", "incorrecto");
                                if (r.value === obj.valor) {
                                    r.parentElement.classList.add("correcto");
                                }
                            });
                        } else {
                            inputs.classList.add("correcto");
                        }
                        puntaje++;
                    } else {
                        if (inputs.length && inputs[0].type === "radio") {
                            inputs.forEach(r => {
                                r.parentElement.classList.remove("correcto", "incorrecto");
                                if (r.checked) {
                                    r.parentElement.classList.add("incorrecto");
                                }
                            });
                        } else {
                            inputs.classList.add("incorrecto");
                        }
                    }

                }


                localStorage.setItem(storagePrefix + "respuestas", JSON.stringify(respuestasUsuario));
                localStorage.setItem(storagePrefix + "puntaje", puntaje);
                localStorage.setItem(storagePrefix + "validado", "true");

                document.getElementById(resultadoId).innerText =
                    `Respuestas correctas: ${puntaje} / ${Object.keys(respuestasDict).length}`;

                // Bloquear inputs y botón después de validar
                bloquearFormulario(formId, botonId);
            }




            // Restaurar progreso de un quiz
            function restaurarQuiz(formId, respuestasDict, resultadoId, botonId, storagePrefix = "") {
                const validado = localStorage.getItem(storagePrefix + "validado") === "true";
                if (validado) {
                    validarFormulario(respuestasDict, formId, resultadoId, botonId, storagePrefix, true);
                } else {
                    const form = document.getElementById(formId);
                    const respuestasGuardadas = JSON.parse(localStorage.getItem(storagePrefix + "respuestas") || "{}");
                    const decimalesGuardados = JSON.parse(localStorage.getItem(storagePrefix + "decimales") || "{}");

                    for (let key in respuestasGuardadas) {
                        if (form.elements[key]) {
                            const el = form.elements[key];
                            if (el.type === "radio") {
                                const radios = form.querySelectorAll(`input[name="${key}"]`);
                                radios.forEach(r => {
                                    r.checked = (r.value === respuestasGuardadas[key]);
                                });
                            } else {
                                el.value = respuestasGuardadas[key];
                            }
                        }
                    }

                    // Habilitar inputs y botón, limpiar estilos y resultado
                    for (let input of form.elements) {
                        if (input.tagName === "INPUT") {
                            input.disabled = false;
                            input.classList.remove("correcto", "incorrecto");
                        }
                    }
                    const botonValidar = document.getElementById(botonId);
                    if (botonValidar) {
                        botonValidar.disabled = false;
                    }
                    document.getElementById(resultadoId).innerText = "";
                }
            }





        </script>


        <form class="quiz-form" id="quiz1">
            <label>
                1. ¿Cuál es el complemento de <strong id="q1_num"></strong> en 8 bits?
                <input type="text" name="q1" placeholder="Ejemplo: 3">
            </label>

            <label>
                2. Si el reloj es de 4 bits, ¿de cuántas horas será?
                <input type="text" name="q2" placeholder="Ejemplo: 256">
            </label>

            <label>
                3. En ese reloj de 4 bits, ¿cuál es el complemento de <strong id="q3_num"></strong>?
                <input type="text" name="q3" placeholder="Ejemplo: 4">
            </label>

            <button type="button" id="botonValidarQ1" class="verifyBtn"
                onclick="validarFormulario(respuestasQ1,'quiz1','resultadosQ1','botonValidarQ1','complemento-q1-')">
                Validar respuestas
            </button>

            <p id="resultadosQ1"></p>
        </form>


        <h2>¿Por qué es conveniente este método?</h2>
        <p>
            ¡Aquí viene lo interesante! En matemáticas, el <strong>negativo de un número positivo es simplemente el
                valor
                que,
                al sumarse, da como resultado cero</strong>. Piensa en <code>5 + (−5) = 0</code>. El sistema de
            complemento
            a 2 aplica
            exactamente esta misma lógica al mundo binario. <strong>Cuando sumas un número binario a su complemento a 2,
                el
                resultado siempre será cero</strong>.
        </p>
        <p>
            Esto funciona de manera consistente, ya sea que lo calcules con números decimales o que sumes directamente
            las
            cadenas de bits:
        </p>
        <section class="ejemplo-modulo">
            <div id="complemento-dos-suma">
                <div class="linea-binaria">
                    <span class="simbolo-operacion"></span> <span class="bit bit-cero">0</span><span
                        class="bit bit-cero">0</span><span class="bit bit-cero">0</span><span
                        class="bit bit-cero">0</span><span class="bit bit-cero">0</span><span
                        class="bit bit-cero">0</span><span class="bit bit-uno">1</span><span
                        class="bit bit-cero">0</span>
                    <span class="valor-decimal">(+2)</span>
                </div>

                <div class="linea-binaria">
                    <span class="simbolo-operacion">+</span> <span class="bit bit-uno">1</span><span
                        class="bit bit-uno">1</span><span class="bit bit-uno">1</span><span
                        class="bit bit-uno">1</span><span class="bit bit-uno">1</span><span
                        class="bit bit-uno">1</span><span class="bit bit-uno">1</span><span
                        class="bit bit-cero">0</span>
                    <span class="valor-decimal">(-2)</span>
                </div>

                <div class="linea-separador"></div>

                <div class="linea-binaria" style="margin-bottom: 0.1rem; justify-content: flex-end;">
                    <span class="bit-acarreo" style="width: 1.2em; text-align: center;"></span> <span
                        class="bit-acarreo" style="width: 1.2em; text-align: center;"></span>
                    <span class="bit-acarreo" style="width: 1.2em; text-align: center;"></span>
                    <span class="bit-acarreo" style="width: 1.2em; text-align: center;"></span>
                    <span class="bit-acarreo" style="width: 1.2em; text-align: center;"></span>
                    <span class="bit-acarreo" style="width: 1.2em; text-align: center;"></span>
                    <span class="bit-acarreo" style="width: 1.2em; text-align: center;"></span>
                    <span class="bit-acarreo" style="width: 1.2em; text-align: center;"></span>

                </div>


                <div class="linea-binaria resultado-binario">

                    <span class="simbolo-operacion"></span>
                    <span class="bit descartado">1</span>
                    <span class="bit bit-cero">0</span><span class="bit bit-cero">0</span><span
                        class="bit bit-cero">0</span><span class="bit bit-cero">0</span><span
                        class="bit bit-cero">0</span><span class="bit bit-cero">0</span><span
                        class="bit bit-cero">0</span><span class="bit bit-cero">0</span>
                    <span class="valor-decimal">( 0)</span>
                </div>
            </div>

            <p class="resultado-explicacion">
                En el resultado, se produce un <strong>bit de acarreo</strong> en la novena posición desde la derecha.
                Este <strong><code>1</code> se
                    descarta</strong> porque estamos trabajando con <strong>números de 8 bits</strong>.
            </p>
        </section>

        <h2>¿Qué rango de valores permite el complemento a 2?</h2>
        <p>Cuando usamos complemento a 2, <strong>la mitad de todas las combinaciones posibles se reserva para
                representar números negativos</strong>.</p>
        <p>
            Eso significa que, aunque con <code>n</code> bits puedes formar <code>2^n</code> combinaciones, el rango de
            valores que puedes representar
            con signo <strong>no</strong> va de <code>0 a 2^n – 1</code>, sino de
            <code>–2^(n-1)  hasta  2^(n-1) – 1</code>.
        </p>

        <p>Por ejemplo, con 8 bits:</p>
        <ul>
            <li><strong>Total de combinaciones:</strong> <code>256</code> (desde <code>00000000</code> hasta
                <code>11111111</code>)
            </li>
            <li><strong>Rango con signo:</strong> de <code>–128</code> a <code>+127</code></li>
            <li><strong>Cero único:</strong> solo una representación <code>00000000</code></li>
            <li><strong>Valor mínimo:</strong> <code>10000000</code> (–128) <em>no tiene opuesto positivo</em></li>
        </ul>

        <p>
            Esta división del espacio de bits es justo lo que determina los límites de los tipos de datos
            enteros en
            Java,
            como byte, short o int. En el próximo capítulo veremos cuántos bits usa cada uno y qué rangos permiten.
        </p>

        <div class="footer-fixed">
            <div class="buttons">
                <button id="previousBtn" class="hidden">Anterior</button>
                <button id="verifyBtn" disabled>Verificar</button>
                <button id="nextBtn" onclick="window.location.href='pag3.html';">Siguiente</button>
            </div>


            <div class="level-counter" id="levelIndicator">2 / ?</div>
        </div>

    </main>

</body>

</html>